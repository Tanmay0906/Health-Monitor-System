<!DOCTYPE html>
<html>
<head>
  <title>Doctor Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .patient-card { background: #fff5f5; padding: 20px; margin: 15px 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    canvas { background: white; margin: 10px 0; max-height: 200px; }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
    @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <h1>üë®‚öïÔ∏è Doctor Dashboard</h1>
  <div id="patientsContainer"></div>

  <script>
    // Initialize Firebase (USE SAME CONFIG AS PATIENT DASHBOARD)
    const firebaseConfig = {
        apiKey: "AIzaSyDZy_6incPr1srlmVEgwIfd3qeuVajl8Mc",
        authDomain: "healthmonitor-112ae.firebaseapp.com",
        projectId: "healthmonitor-112ae",
        storageBucket: "healthmonitor-112ae.firebasestorage.app",
        messagingSenderId: "1083807746163",
        appId: "1:1083807746163:web:3065ee2d00423921928206"
    };
    firebase.initializeApp(firebaseConfig);

    // Listen for Patient Data
    firebase.database().ref('patients').on('value', (snapshot) => {
      const patients = snapshot.val();
      const container = document.getElementById('patientsContainer');
      container.innerHTML = '';

      if (!patients) {
        container.innerHTML = '<p>No patient data available</p>';
        return;
      }

      Object.entries(patients).forEach(([id, patient]) => {
        const card = document.createElement('div');
        card.className = 'patient-card';
        
        // Generate random ECG data
        const ecgData = [];
        for (let i = 0; i < 50; i++) {
          ecgData.push(Math.random() > 0.9 ? 5 : Math.random() > 0.7 ? -1 : 0);
        }

        card.innerHTML = `
          <h2>üë®‚öïÔ∏è ${patient.name}</h2>
          <p><strong>Last Update:</strong> ${patient.timestamp}</p>
          
          <div class="grid">
            <div>
              <h3>Heart Rate</h3>
              <canvas id="hrChart-${id}"></canvas>
              <p><strong>Current:</strong> ${patient.hr} BPM</p>
            </div>
            
            <div>
              <h3>SpO2 Level</h3>
              <canvas id="spo2Chart-${id}"></canvas>
              <p><strong>Current:</strong> ${patient.spo2}%</p>
            </div>
            
            <div>
              <h3>Temperature</h3>
              <canvas id="tempChart-${id}"></canvas>
              <p><strong>Current:</strong> ${patient.temp}¬∞C</p>
            </div>
            
            <div>
              <h3>ECG Simulation</h3>
              <canvas id="ecgChart-${id}"></canvas>
            </div>
          </div>
          
          <div style="margin-top:15px; padding:10px; background:${patient.risk.includes('HIGH') ? '#ffdddd' : '#ddffdd'}">
            <strong>BP:</strong> ${patient.bp} | 
            <strong>Risk:</strong> ${patient.risk}
          </div>
        `;

        container.appendChild(card);

        // Initialize Charts
        initChart(`hrChart-${id}`, 'Heart Rate (BPM)', [patient.hr], 'red', 50, 120);
        initChart(`spo2Chart-${id}`, 'SpO2 (%)', [patient.spo2], 'blue', 80, 100);
        initChart(`tempChart-${id}`, 'Temp (¬∞C)', [patient.temp], 'orange', 35, 40);
        initECGChart(`ecgChart-${id}`, ecgData);
      });
    });

    function initChart(canvasId, label, data, color, min, max) {
      new Chart(document.getElementById(canvasId).getContext('2d'), {
        type: 'line',
        data: {
          labels: ['Now'],
          datasets: [{
            label: label,
            data: data,
            borderColor: color,
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          scales: { y: { min, max } },
          }
        });

    }

    function initECGChart(canvasId, data) {
      new Chart(document.getElementById(canvasId).getContext('2d'), {
        type: 'line',
        data: {
          labels: Array(data.length).fill(''),
          datasets: [{
            label: 'ECG',
            data: data,
            borderColor: 'green',
            pointRadius: 0
          }]
        },
        options: {
          responsive: true,
          scales: { y: { min: -2, max: 6 } }
        }
      });
    }
  </script>
</body>
</html>